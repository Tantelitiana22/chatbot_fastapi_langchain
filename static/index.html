<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Chatbot LangChain Ollama - Interface de chat moderne et responsive">
  <title>Chatbot LangChain Ollama</title>
  <link rel="stylesheet" href="/static/styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <!-- Monaco Editor -->
  <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/loader.js"></script>
</head>
<body class="dark">
  <div id="app">
    <header>
      <h1>Chatbot LangChain Ollama</h1>
      <div class="header-controls">
        <label for="lang" class="sr-only">SÃ©lectionner la langue</label>
        <select id="lang" aria-label="Langue">
          <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
          <option value="en">ğŸ‡ºğŸ‡¸ English</option>
        </select>
        <label for="memoryType" class="sr-only">Type de mÃ©moire</label>
        <select id="memoryType" aria-label="Type de mÃ©moire">
          <option value="buffer">ğŸ§  Buffer complet</option>
          <option value="summary">ğŸ“ RÃ©sumÃ© intelligent</option>
          <option value="token_buffer">âš¡ Buffer limitÃ©</option>
        </select>
        <label for="apiKey" class="sr-only">Token utilisateur</label>
        <input type="text" id="apiKey" placeholder="Token utilisateur (ex: devtoken123)" aria-label="Token utilisateur" value="devtoken123" required>
        <div class="token-help" style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.25rem;">
          Tokens valides: devtoken123, token_user1, token_user2
        </div>
        <button id="settingsBtn" aria-label="ParamÃ¨tres" title="Ouvrir les paramÃ¨tres">
          <span class="settings-icon">âš™ï¸</span>
        </button>
        <button id="themeToggle" aria-label="Basculer le thÃ¨me" title="Basculer entre le mode sombre et clair">
          <span class="theme-icon">â˜€ï¸</span>
        </button>
        <button id="sidebarToggle" class="mobile-only" aria-label="Ouvrir le menu" title="Ouvrir le menu des conversations">
          <span>â˜°</span>
        </button>
      </div>
    </header>

    <aside id="sidebar" aria-label="Liste des conversations">
      <div class="sidebar-header">
        <h3>Conversations</h3>
        <button id="sidebarClose" class="mobile-only" aria-label="Fermer le menu">
          <span>âœ•</span>
        </button>
      </div>
      <button id="newConversationBtn" class="new-conversation-btn">
        <span class="button-icon">â•</span>
        <span class="button-text">New Conversation</span>
      </button>

      <div class="memory-info" id="memoryInfo" style="display: none;">
        <div class="memory-stats">
          <div class="memory-type-label">Type de mÃ©moire:</div>
          <div class="memory-type-value" id="currentMemoryType"></div>
          <div class="memory-count-label">Messages en mÃ©moire:</div>
          <div class="memory-count-value" id="currentMemoryCount">0</div>
        </div>
      </div>

      <ul id="convList" role="list" aria-label="Liste des conversations"></ul>
    </aside>

    <main role="main" aria-label="Zone de chat principale">
      <div id="messages" role="log" aria-live="polite" aria-label="Messages de la conversation"></div>

      <!-- Typing indicator -->
      <div id="typingIndicator" class="typing-indicator-container" style="display: none;">
        <div class="typing-indicator">
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
        </div>
        <span class="typing-text">AI is thinking...</span>
      </div>
      <form id="chatForm" aria-label="Formulaire d'envoi de message">
        <div class="input-group">
          <label for="messageInput" class="sr-only">Votre message</label>
          <textarea
            id="messageInput"
            placeholder="Tapez votre message ici..."
            aria-label="Zone de saisie du message"
            rows="1"
            maxlength="4000"
          ></textarea>
          <div class="button-group">
            <button type="submit" aria-label="Envoyer le message via SSE">
              <span class="button-icon">ğŸ“¤</span>
              <span class="button-text">Envoyer</span>
            </button>
            <button type="button" id="sendWs" aria-label="Envoyer le message via WebSocket">
              <span class="button-icon">ğŸ”Œ</span>
              <span class="button-text">WebSocket</span>
            </button>
            <button type="button" id="stopWs" aria-label="ArrÃªter la gÃ©nÃ©ration" disabled>
              <span class="button-icon">â¹ï¸</span>
              <span class="button-text">Stop</span>
            </button>
          </div>
        </div>
      </form>
    </main>
  </div>

  <!-- Loading overlay -->
  <div id="loadingOverlay" class="loading-overlay" aria-hidden="true">
    <div class="loading-spinner"></div>
    <p>GÃ©nÃ©ration en cours...</p>
  </div>

  <!-- Code Editor Modal -->
  <div id="codeEditorModal" class="code-editor-modal" aria-hidden="true" role="dialog" aria-labelledby="codeEditorTitle" aria-modal="true">
    <div class="code-editor-container">
      <div class="code-editor-header">
        <div class="editor-title-group">
          <h2 id="codeEditorTitle">Code Editor</h2>
          <span id="codeEditorLanguage" class="language-badge">text</span>
        </div>
        <div class="editor-controls">
          <div class="indentation-controls">
            <button id="indentBtn" class="editor-btn" title="Indent (Tab)">
              <span class="btn-icon">â®</span>
              <span class="btn-text">Indent</span>
            </button>
            <button id="unindentBtn" class="editor-btn" title="Unindent (Shift+Tab)">
              <span class="btn-icon">â®œ</span>
              <span class="btn-text">Unindent</span>
            </button>
          </div>
          <div class="action-controls">
            <button id="copyCodeBtn" class="editor-btn" title="Copy to clipboard">
              <span class="btn-icon">ğŸ“‹</span>
              <span class="btn-text">Copy</span>
            </button>
            <button id="downloadCodeBtn" class="editor-btn" title="Download as file">
              <span class="btn-icon">ğŸ’¾</span>
              <span class="btn-text">Download</span>
            </button>
            <button id="formatCodeBtn" class="editor-btn" title="Format code">
              <span class="btn-icon">âœ¨</span>
              <span class="btn-text">Format</span>
            </button>
            <button id="closeCodeEditor" class="editor-btn close-btn" title="Close editor">
              <span class="btn-icon">âœ•</span>
              <span class="btn-text">Close</span>
            </button>
          </div>
        </div>
      </div>
      <div class="code-editor-content">
        <div id="codeEditorContainer" class="code-editor-container-monaco"></div>
        <div id="codeEditorPreview" class="code-editor-preview"></div>
      </div>
      <div class="code-editor-footer">
        <div class="editor-info">
          <span id="codeEditorLines" class="line-count">0 lines</span>
          <span id="codeEditorChars" class="char-count">0 characters</span>
        </div>
        <div class="editor-actions">
          <button id="saveCodeBtn" class="editor-btn primary" title="Save changes">
            <span class="btn-icon">ğŸ’¾</span>
            <span class="btn-text">Save</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settingsModal" class="settings-modal" aria-hidden="true" role="dialog" aria-labelledby="settingsTitle" aria-modal="true">
    <div class="settings-container">
      <div class="settings-header">
        <h2 id="settingsTitle">âš™ï¸ ParamÃ¨tres</h2>
        <button id="closeSettings" class="close-btn" aria-label="Fermer les paramÃ¨tres">
          <span>âœ•</span>
        </button>
      </div>

      <div class="settings-content">
        <form id="settingsForm">
          <!-- Language Selection -->
          <div class="setting-group">
            <label for="settingsLang" class="setting-label">
              <span class="setting-icon">ğŸŒ</span>
              Langue / Language
            </label>
            <select id="settingsLang" class="setting-input">
              <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
              <option value="en">ğŸ‡ºğŸ‡¸ English</option>
            </select>
          </div>

          <!-- Model Selection -->
          <div class="setting-group">
            <label for="settingsModel" class="setting-label">
              <span class="setting-icon">ğŸ¤–</span>
              ModÃ¨le / Model
            </label>
            <select id="settingsModel" class="setting-input">
              <option value="mistral">Mistral (GÃ©nÃ©ral)</option>
              <option value="deepseek-coder">DeepSeek Coder (Code)</option>
              <option value="llama3">Llama3 (Conversation)</option>
            </select>
            <div class="setting-description">
              Mistral: Bon pour les conversations gÃ©nÃ©rales<br>
              DeepSeek Coder: OptimisÃ© pour le code<br>
              Llama3: Excellent pour les conversations longues
            </div>
          </div>

          <!-- Memory Type -->
          <div class="setting-group">
            <label for="settingsMemoryType" class="setting-label">
              <span class="setting-icon">ğŸ§ </span>
              Type de mÃ©moire / Memory Type
            </label>
            <select id="settingsMemoryType" class="setting-input">
              <option value="buffer">ğŸ§  Buffer complet</option>
              <option value="summary">ğŸ“ RÃ©sumÃ© intelligent</option>
              <option value="token_buffer">âš¡ Buffer limitÃ©</option>
            </select>
            <div class="setting-description">
              Buffer complet: Garde tous les messages<br>
              RÃ©sumÃ© intelligent: RÃ©sume les anciens messages<br>
              Buffer limitÃ©: Limite le nombre de tokens
            </div>
          </div>

          <!-- Token -->
          <div class="setting-group">
            <label for="settingsToken" class="setting-label">
              <span class="setting-icon">ğŸ”‘</span>
              Token d'authentification
            </label>
            <input type="text" id="settingsToken" class="setting-input" placeholder="Token utilisateur (ex: devtoken123)" required>
            <div class="setting-description">
              Tokens valides: devtoken123, token_user1, token_user2
            </div>
          </div>

          <!-- Advanced Settings -->
          <div class="setting-group">
            <label class="setting-label">
              <span class="setting-icon">ğŸ”§</span>
              ParamÃ¨tres avancÃ©s
            </label>
            <div class="advanced-settings">
              <label class="checkbox-label">
                <input type="checkbox" id="settingsAutoSave" checked>
                <span class="checkmark"></span>
                Sauvegarde automatique des conversations
              </label>
              <label class="checkbox-label">
                <input type="checkbox" id="settingsShowTimestamps" checked>
                <span class="checkmark"></span>
                Afficher les horodatages
              </label>
              <label class="checkbox-label">
                <input type="checkbox" id="settingsDarkMode" checked>
                <span class="checkmark"></span>
                Mode sombre par dÃ©faut
              </label>
            </div>
          </div>
        </form>
      </div>

      <div class="settings-footer">
        <button type="button" id="resetSettings" class="btn-secondary">
          <span class="btn-icon">ğŸ”„</span>
          <span class="btn-text">RÃ©initialiser</span>
        </button>
        <button type="button" id="saveSettings" class="btn-primary">
          <span class="btn-icon">ğŸ’¾</span>
          <span class="btn-text">Sauvegarder</span>
        </button>
      </div>
    </div>
  </div>

  <script src="/static/app.js"></script>
</body>
</html>
